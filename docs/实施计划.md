# HVI-CIDNet 架构图绘制计划（基于论文文本+图片）

## 论文核心图片分析

根据您提供的4张图片：

| 图片 | 内容 | 用途 |
|------|------|------|
| Figure 1 | sRGB→HSV→HVI颜色空间转换 | 理解HVI颜色空间的动机和转换过程 |
| Figure 2 | CIDNet整体架构图 | 理解网络结构和数据流 |
| Table 1 + Figure 3 | 性能对比 | 展示模型效果 |
| Figure 5 | 消融实验对比 | 验证各组件作用 |

---

## 图1：HVI颜色空间转换流程图

### 基于Figure 1的设计

论文Figure 1展示了四个阶段的颜色空间转换：

```
(a) sRGB                (b) HSV                    (c) w/ Polarization        (d) HVI
┌──────────────┐       ┌──────────────────┐       ┌──────────────────┐      ┌──────────────────┐
│              │       │                  │       │                  │      │                  │
│   立方体     │  ──►  │   圆柱体         │  ──►  │   圆盘极化       │ ──►  │   坍缩后空间     │
│   RGB空间    │       │   HSV空间        │       │   解决①红色问题  │      │   解决②黑色问题  │
│              │       │   ①红色不连续   │       │                  │      │                  │
│ High Color   │       │   ②黑色平面噪声 │       │                  │      │   可学习参数Ck   │
│ Sensitivity  │       │                  │       │                  │      │                  │
└──────────────┘       └──────────────────┘       └──────────────────┘      └──────────────────┘
     😠                      😠①                         ☺                         ☺
Color Distortion       Red and Black              Black Artifacts          Well-enhanced
                       Artifacts                   Reduced
```

### 数学公式流程

```
sRGB [R,G,B]
    │
    ▼
┌─────────────────────────────────┐
│ Step 1: 计算强度图 (Max-RGB)    │
│   Imax = max(R, G, B)           │
└─────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────┐
│ Step 2: 计算饱和度 S            │
│   Δ = Imax - min(R,G,B)         │
│   S = Δ / Imax                  │
└─────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────┐
│ Step 3: 计算色调 H              │
│   根据最大通道分情况计算         │
│   H ∈ [0, 1]                    │
└─────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────┐
│ Step 4: 极化操作 (解决红色不连续)        │
│   h = cos(π·H/3)  ← 水平分量            │
│   v = sin(π·H/3)  ← 垂直分量            │
│   目的: 红色h=0和h=6变为相同坐标         │
└─────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────┐
│ Step 5: 可学习强度坍缩 (解决黑色噪声)    │
│   Ck = (sin(π·Imax/2) + ε)^(1/k)        │
│   k ∈ Q+ 是可训练参数 (density_k)       │
│   目的: 将低亮度区域点聚拢减少噪声       │
└─────────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────────┐
│ Step 6: 生成HVI三通道                   │
│   Ĥ = Ck ⊙ S ⊙ h  (Horizontal)         │
│   V̂ = Ck ⊙ S ⊙ v  (Vertical)           │
│   I = Imax         (Intensity)          │
└─────────────────────────────────────────┘
    │
    ▼
HVI [Ĥ, V̂, I]
```

---

## 图2：CIDNet网络整体架构图

### 基于Figure 2的设计

论文Figure 2明确展示了三个部分：

```
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                              CIDNet 整体架构 (Figure 2)                                  │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                         │
│  Input Image                                                                            │
│  (H×W×3)                                                                                │
│      │                                                                                  │
│      ▼                                                                                  │
│  ╔═══════════════════════════════════════════════════════════════╗                     │
│  ║           (a) HVI Color Transformation                         ║                     │
│  ╠═══════════════════════════════════════════════════════════════╣                     │
│  ║                                                                ║                     │
│  ║    sRGB ──► Conv 3×3 ──► Channel-wise ──► Density-k ──► Add   ║                     │
│  ║              │           Concatenation     guidance            ║                     │
│  ║              ▼                                                 ║                     │
│  ║         Intensity Map (H×W×1)                                  ║                     │
│  ║              +                                                 ║                     │
│  ║         HV Color Map (H×W×2)                                   ║                     │
│  ║              │                                                 ║                     │
│  ║              ▼                                                 ║                     │
│  ║            HVT (可学习参数k)                                    ║                     │
│  ╚═══════════════════════════════════════════════════════════════╝                     │
│      │                                 │                                                │
│      │ Intensity Feature               │ HV Feature                                     │
│      │ (H×W×C)                         │ (H×W×C)                                        │
│      ▼                                 ▼                                                │
│  ╔═══════════════════════════════════════════════════════════════════════════════╗     │
│  ║               (b) Enhancement Network (双分支UNet)                              ║     │
│  ╠═══════════════════════════════════════════════════════════════════════════════╣     │
│  ║                                                                                ║     │
│  ║   I-Branch                                         HV-Branch                   ║     │
│  ║   (Conv 3×3)                                      (Conv 3×3)                   ║     │
│  ║      │                                                │                        ║     │
│  ║      │←─────────────── Skip Connection ───────────────│                        ║     │
│  ║      ▼                                                ▼                        ║     │
│  ║   ┌─────┐    ×2         ×2        ×2    ┌─────┐                               ║     │
│  ║   │Down │───►───► LCA ◄───►───►───│Down │                                     ║     │
│  ║   │H→H/2│        模块            │H→H/2│                                      ║     │
│  ║   └─────┘                        └─────┘                                      ║     │
│  ║      │                              │                                          ║     │
│  ║      │←─────────────── Skip Connection ───────────────│                        ║     │
│  ║      ▼                                                ▼                        ║     │
│  ║   ┌──────┐              ×2        ┌──────┐                                    ║     │
│  ║   │Down  │───►──► LCA ◄───►──────│Down  │                                     ║     │
│  ║   │H/2→  │       模块            │H/2→  │                                      ║     │
│  ║   │H/4×2C│                       │H/4×2C│                                      ║     │
│  ║   └──────┘                       └──────┘                                      ║     │
│  ║      │                              │                                          ║     │
│  ║      │←─────────────── Skip Connection ───────────────│                        ║     │
│  ║      ▼                                                ▼                        ║     │
│  ║   ┌──────┐              ×2        ┌──────┐                                    ║     │
│  ║   │Down  │───►──► LCA ◄───►──────│Down  │                                     ║     │
│  ║   │H/4→  │       模块            │H/4→  │                                      ║     │
│  ║   │H/8×4C│                       │H/8×4C│                                      ║     │
│  ║   └──────┘                       └──────┘                                      ║     │
│  ║      │                              │                                          ║     │
│  ║      └─────────► LCA ×2 ◄──────────┘                                          ║     │
│  ║                   │                                                            ║     │
│  ║      ┌────────────┴────────────┐                                              ║     │
│  ║      ▼                         ▼                                              ║     │
│  ║   ┌──────┐                  ┌──────┐                                          ║     │
│  ║   │ Up   │◄── skip         │ Up   │◄── skip                                   ║     │
│  ║   │H/8→  │                  │H/8→  │                                           ║     │
│  ║   │H/4×2C│◄───► LCA ◄──────│H/4×2C│                                           ║     │
│  ║   └──────┘                  └──────┘                                          ║     │
│  ║      │                         │                                              ║     │
│  ║      ▼                         ▼                                              ║     │
│  ║   ┌─────┐                   ┌─────┐                                           ║     │
│  ║   │ Up  │◄── skip          │ Up  │◄── skip                                    ║     │
│  ║   │→H/2 │◄───► LCA ◄───────│→H/2 │                                            ║     │
│  ║   └─────┘                   └─────┘                                           ║     │
│  ║      │                         │                                              ║     │
│  ║      ▼                         ▼                                              ║     │
│  ║      I (H×W×C)                 HV (H×W×C)                                     ║     │
│  ║                                                                               ║     │
│  ╚═══════════════════════════════════════════════════════════════════════════════╝     │
│      │                                 │                                                │
│      └─────────────┬───────────────────┘                                                │
│                    ▼                                                                    │
│              ┌───────────┐                                                              │
│              │  G + ⊕    │  ← 残差连接                                                  │
│              └───────────┘                                                              │
│                    │                                                                    │
│                    ▼                                                                    │
│  ╔═══════════════════════════════════════════════════════════════╗                     │
│  ║        (c) PHVIT (Perceptual-inverse HVI Transform)           ║                     │
│  ╠═══════════════════════════════════════════════════════════════╣                     │
│  ║                                                                ║                     │
│  ║   HVI增强图 ──► 逆转换 ──► αS(饱和度) + αI(亮度) ──► sRGB      ║                     │
│  ║                                                                ║                     │
│  ╚═══════════════════════════════════════════════════════════════╝                     │
│                    │                                                                    │
│                    ▼                                                                    │
│              Enhanced Image                                                             │
│              (H×W×3)                                                                    │
│                                                                                         │
└─────────────────────────────────────────────────────────────────────────────────────────┘
```

### 关键设计点（来自Figure 2底部图例）

| 符号 | 含义 |
|------|------|
| Conv 3×3 | 3×3卷积 |
| G | Channel-wise Concatenation (通道拼接) |
| ★ | Density-k guidance (密度k引导) |
| + | Add (相加) |
| ⇒ | I-branch Conv 3×3 |
| ⇒ | HV-branch Conv 3×3 |
| LCA | Lighten Cross-Attention |

---

## 图3：LCA模块详细结构

```
┌─────────────────────────────────────────────────────────────┐
│              LCA (Lighten Cross-Attention Block)             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│     x (Query流)              y (Key-Value流)                │
│         │                         │                         │
│         ▼                         ▼                         │
│    ┌─────────┐              ┌─────────┐                    │
│    │LayerNorm│              │LayerNorm│                    │
│    └─────────┘              └─────────┘                    │
│         │                         │                         │
│         │         Cross Attention                           │
│         ▼                         ▼                         │
│    ┌─────────────────────────────────────────┐             │
│    │          CAB (Cross Attention Block)    │             │
│    │                                         │             │
│    │   Q = DWConv₃×₃(Conv₁×₁(x))            │             │
│    │   K = DWConv₃×₃(Conv₁×₁(y))            │             │
│    │   V = DWConv₃×₃(Conv₁×₁(y))            │             │
│    │                                         │             │
│    │   Attn = softmax(Q·K^T / τ) · V        │             │
│    │   τ: 可学习温度参数                     │             │
│    └─────────────────────────────────────────┘             │
│         │                                                   │
│         + ←── 残差连接                                       │
│         │                                                   │
│         ▼                                                   │
│    ┌─────────┐                                             │
│    │LayerNorm│                                             │
│    └─────────┘                                             │
│         │                                                   │
│         ▼                                                   │
│    ┌─────────────────────────────────────────┐             │
│    │         IEL (Intensity Enhancement)      │             │
│    │                                          │             │
│    │   input → Conv₁×₁ → DWConv₃×₃           │             │
│    │                 ↓                        │             │
│    │              Split                       │             │
│    │            ↙     ↘                      │             │
│    │     DWConv₃×₃   DWConv₃×₃               │             │
│    │         ↓           ↓                    │             │
│    │       Tanh        Tanh                   │             │
│    │         ↓           ↓                    │             │
│    │         +残差       +残差                │             │
│    │         ↓           ↓                    │             │
│    │          x1   ⊙    x2  (门控机制)        │             │
│    │              ↓                           │             │
│    │          Conv₁×₁                         │             │
│    └─────────────────────────────────────────┘             │
│         │                                                   │
│         + ←── 残差连接 (仅I_LCA有)                           │
│         │                                                   │
│         ▼                                                   │
│      输出                                                   │
└─────────────────────────────────────────────────────────────┘
```

---

## 设计总结

根据论文和图片，需要生成的架构图：

1. **HVI颜色空间转换图** - 展示sRGB→HSV→极化→HVI的完整流程
2. **CIDNet整体架构图** - 展示三阶段处理流程和双分支UNet结构
3. **(可选) LCA模块详细图** - 展示交叉注意力和IEL模块内部结构

请确认是否需要按此计划生成图片。
